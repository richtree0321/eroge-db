# VNDB データダンプ (`vndb-db-2026-01-10`) 分析レポート

提供されたフォルダ `@[vndb-db-2026-01-10]` の内容を分析しました。
これは **VNDB の全データを網羅したデータベースダンプ** です。

## 1. ファイル構成と意味

このダンプは「PostgreSQL」というデータベースに直接読み込ませるための形式（COPY フォーマット）になっています。

- **`schema_plain.sql`**: 設計図（Schema）。どのようなテーブルがあり、どんなデータが入るかが書かれています。
- **`db/` ディレクトリ**: 実際のデータファイルが入っています。
  - **`vn`**: ゲーム本体のデータ（タイトル、画像 ID、あらすじ、評価点など）
  - **`vn_titles`**: ゲームの別名タイトル（日本語タイトルなどはここにある可能性が高い）
  - **`tags` / `tags_vn`**: タグの定義と、どのゲームにどのタグが付いているかの紐付け情報
  - **`chars` / `chars_vns`**: キャラクター情報と出演作品
  - **`staff` / `vn_staff`**: 声優やスタッフ情報

## 2. API 版（現在の開発手法）との違い

| 特徴           | API 利用 (現在)                                                                                | ダンプ利用 (このファイル)                                                                   |
| :------------- | :--------------------------------------------------------------------------------------------- | :------------------------------------------------------------------------------------------ |
| **データ構造** | **JSONB (非正規化)**<br>1 つのゲームデータの中にタグや開発者を全部詰め込んでいる。扱いやすい。 | **リレーショナル (正規化)**<br>30 個以上のテーブルにバラバラに保存され、ID で紐付いている。 |
| **日本語対応** | API は英語メインの場合が多い。                                                                 | `vn_titles` テーブルなどに日本語データが確実に含まれている。                                |
| **更新**       | 毎回 API を叩くか、部分更新。                                                                  | 1 日 1 回の全量更新（このファイルを毎日取り込む運用）。                                     |
| **難易度**     | 初心者向き。直感的。                                                                           | 中〜上級者向き。SQL の **JOIN（結合）** を使いこなす必要がある。                            |

## 3. このデータを活用する戦略（おすすめ）

現在の「JSONB で扱いやすくする」という方針を変えずに、このリッチなデータを取り込むには、以下の **「ETL (Extract Transform Load) 戦略」** が有効です。

### ステップ A: 一時データベースへの取り込み

このダンプファイルを、現在のアプリ用 DB (`erogedb`) とは別の、**データ解析用 DB (`vndb_raw`)** に丸ごとインポートします。

### ステップ B: データの加工と転送

解析用 DB から必要なデータを SQL で結合して抜き出し、現在のアプリ用 DB の形（JSONB）に整形して保存します。

**イメージ:**

```sql
-- 解析用DBでの操作イメージ
SELECT
  v.id,
  v.title,
  t.title as japanese_title, -- vn_titlesから日本語を取得
  ...
FROM vn v
LEFT JOIN vn_titles t ON v.id = t.id AND t.lang = 'ja'
...
```

↓
これを Python スクリプトで読み取り、`visual_novels` テーブルに保存。

## 4. 結論

このフォルダは **「宝の山」** です。
API では取得制限があったり、細切れにしか取れなかった情報が全て手元にあります。
将来的に「声優検索」や「複雑な条件検索」を作るなら、このダンプの導入は必須になります。

まずは現在の「詳細ページ」の実装が落ち着いたら、このダンプを読み込むためのスクリプト作成（インポート機能）に挑戦するのが良い次のステップになります。
