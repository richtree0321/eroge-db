# Jupyter導入とインフラ構築へ

> Exported on: 2026/1/9 23:11:54

---

## 👤 You

続きから始めたいけど少し相談がある  前にpythonをいじっていたときにjupyternotebookだとすごいやりやすかった  今回は導入するべきかな？

## 🤖 Gemini

**結論から言うと、「導入しましょう！」**
ただし、以前のように「開発のすべてを Jupyter Notebook で完結させる」のではなく、**「実験室（Jupyter）」と「工場（.pyスクリプト）」を使い分けるスタイル**をおすすめします。

インフラエンジニア志望という観点から、その理由と具体的な導入手順を解説します。

---

### 1. インフラエンジニア視点での「使い分け」

Jupyter Notebook は非常に強力ですが、AWS や Docker で動かす「本番システム」には向きません。なぜなら、サーバー上で「セルを1つずつ手動実行」することはできないからです。

このプロジェクトでは、以下のように役割を分担するのが**「プロのやり方」**です。

| ツール | 役割 (イメージ) | 用途 |
| --- | --- | --- |
| **Jupyter Notebook** (`.ipynb`) | **実験室 / 下書き** | ・APIからどんなデータが返ってくるか確認する<br>

<br>・データの加工方法を試行錯誤する<br>

<br>・グラフを描画して分析する |
| **Python Script** (`.py`) | **工場 / 本番製品** | ・Dockerの中で自動実行させる<br>

<br>・定期的にデータを取得する<br>

<br>・Webアプリの本体 |

**今回のおすすめフロー：**

1. Jupyter で API を叩いて、データの形を確認する（試行錯誤）。
2. うまくいったロジックをコピーして、`.py` ファイルに清書する。
3. Docker で `.py` を動かす。

この流れだと、開発効率が爆上がりします。

---

### 2. 現在の環境 (WSL2) への導入手順

前回のセッションで「PEP 668」対策として `venv` (仮想環境) を作りましたね。
Jupyter もシステム全体に入れるのではなく、**この仮想環境の中にインストール**するのが正解です。

#### 手順

WSL2のターミナルを開き、プロジェクトフォルダ (`eroge-db`) に移動して以下を実行してください。

1. **仮想環境に入る** (必須！)
```bash
source .venv/bin/activate
# プロンプトの先頭に (.venv) が付いていることを確認

```


2. **Jupyter 関連ライブラリのインストール**
重たい Anaconda などを入れる必要はありません。必要なものだけを `pip` で入れます。
```bash
pip install ipykernel

```


*※Cursor や VS Code を使っている場合、これだけでエディタ上で Notebook が開けます。*
3. **動作確認**
エディタ（Cursor等）側で、プロジェクト内に新しいファイル `experiment.ipynb` を作成してみてください。
* コードブロックに `print("Hello from Jupyter")` と書いて実行ボタンを押す。
* 「カーネルの選択」を求められたら、**「Python Environments」→「.venv (eroge-db)」** を選んでください。



---

### 3. このプロジェクトでの活用例

次回のタスク「VNDBのデータをPostgreSQLに入れる」で、Jupyterが大活躍します。

* **Jupyterがない場合**:
コードを書く → `python main.py`を実行 → エラーで落ちる → ログを見る → コードを直す（繰り返し）
* **Jupyterがある場合**:
APIからデータを1回取得して変数に入れておく → その変数をセル上で何度でもいじくり回して、DBに入れる形（JSONの整形など）を試す → **成功したコードだけをスクリプトに移す**

これで「APIのアクセス制限（叩きすぎ）」も防げます。

---

### 次のアクション

Jupyter (`ipykernel`) のインストールは数分で終わると思います。
導入が完了したら、いよいよ**Docker で PostgreSQL を立ち上げる（インフラ構築）**作業に入りましょう。

**準備ができたら、「Jupyter入れた。Docker作成に進みたい」と教えてください。**
`docker-compose.yml` の書き方からガイドします。

---

## 👤 You

Jupyter入れた。Docker作成に進みたい

## 🤖 Gemini

素晴らしい進捗です！Jupyter環境、実験に大いに役立つはずです。

では、いよいよインフラ構築の第一歩、**「Docker Compose で PostgreSQL を召喚する」**フェーズに入りましょう。

インフラエンジニア志望として、単にコピペで動かすのではなく、**「構成ファイル (`docker-compose.yml`) でサーバーの仕様を定義する」** 感覚を掴んでください。これが現代のインフラ構築 (Infrastructure as Code) の基本です。

---

### 1. 今回作る構成のイメージ

WSL2というPCの中に、**「DB専用の隔離された箱（コンテナ）」**をポンと置くイメージです。

* **Port (5432)**: 箱の外（WSL2やPython）からアクセスするための「ドア」。
* **Volume**: 箱の中のデータを、外（WSL2のフォルダ）に保存しておくための「命綱」。これがないと、箱を消した瞬間にデータも消えます。

---

### 2. `docker-compose.yml` の作成

プロジェクトのルートディレクトリ (`eroge-db/`) に、`docker-compose.yml` という名前で新しいファイルを作成し、以下の内容を記述してください。

```yaml
services:
  # サービス名: ここではシンプルに 'db' とします
  db:
    # 使用するイメージ: 公式のPostgreSQL バージョン15を使用
    image: postgres:15
    
    # コンテナ名: docker ps で見た時にわかりやすい名前をつける
    container_name: eroge-postgres
    
    # 環境変数: DBの初期ユーザーとパスワード、DB名を設定
    # ※本番環境ではパスワードを直書きせず .env ファイルを使いますが、
    #   開発段階なのでわかりやすさ優先でここに書きます。
    environment:
      POSTGRES_USER: myuser
      POSTGRES_PASSWORD: mypassword
      POSTGRES_DB: erogedb
    
    # ポートフォワーディング: 
    # 左側がホスト(WSL2)のポート : 右側がコンテナ内のポート
    ports:
      - "5432:5432"
    
    # ボリュームマウント (データの永続化):
    # 左側がホストのフォルダ : 右側がコンテナ内のデータ保存場所
    # これにより、プロジェクトフォルダに 'postgres_data' というフォルダが自動生成され、
    # そこにDBのデータが保存されます。
    volumes:
      - ./postgres_data:/var/lib/postgresql/data

```

---

### 3. コンテナの起動

WSL2のターミナルで以下のコマンドを実行します。これが「サーバー構築」のコマンドです。

```bash
# -d は "Detached" モード（バックグラウンド実行）の意味です。
# これを付けないとログが画面を占有して操作できなくなります。
docker compose up -d

```

初回はPostgreSQLのイメージ（数百MB）をダウンロードするため、少し時間がかかります。

---

### 4. 起動確認

エラーが出ずにプロンプトが戻ってきたら、以下のコマンドで稼働状況を確認します。

```bash
docker compose ps

```

**成功時の表示例:**
`STATUS` の欄が `Up ...` になっていれば成功です。
`Exited` や `Restarting` になっている場合は何らかのエラーで落ちています（その場合は `docker compose logs` で原因を見ます）。

---

### 5. データ永続化の確認 (インフラ視点で重要！)

`ls -F` コマンドなどでディレクトリの中身を見てください。
`postgres_data/` というディレクトリが勝手に作られていませんか？

```bash
ls -F
# 出力例: postgres_data/  docker-compose.yml  vndb_test.py ...

```

これが **「Volumeマウント」** の効果です。
コンテナの中にあるDBデータの実体が、あなたの手元の `postgres_data` フォルダに同期されています。
これにより、**「コンテナを削除しても、作り直せばデータは復活する」** という安全な運用が可能になります。

---

### 次のステップ

DBサーバーが無事に立ち上がりました！
次は、**Python (Jupyter) からこのDBに接続できるかテスト** してみましょう。

**DBが `Up` 状態で、`postgres_data` ディレクトリが生成されていることが確認できたら教えてください。**
接続用のライブラリ (`psycopg2`) の導入に進みます。

---

## 👤 You

The command 'docker' could not be found in this WSL 2 distro.  We recommend to activate the WSL integration in Docker Desktop settings.  For details about using Docker Desktop with WSL 2, visit:  https://docs.docker.com/go/wsl2/

## 🤖 Gemini

このエラーは、**「Windows側にはDocker Desktopが入っているけれど、Ubuntu側（WSL2）にそのドアが開かれていない」** という状態です。よくある初期設定の儀式ですので、サクッと解決しましょう。

Windows側の操作で「スイッチを入れる」必要があります。

### 解決手順 (Windows側での操作)

1. **Docker Desktop を開く**
Windowsのスタートメニューから「Docker Desktop」を起動してください。
2. **設定画面へ行く**
画面右上の **歯車アイコン (Settings)** をクリックします。
3. **WSL連携を有効にする**
* 左メニューの **[Resources]** をクリック。
* その下の **[WSL integration]** を選択。
* **"Enable integration with my default WSL distro"** にチェックが入っているか確認します。
* その下にある **"Enable integration with additional distros"** のリストに `Ubuntu` があるはずです。
* **Ubuntu のスイッチを「ON」にしてください。**


4. **設定を保存**
右下の **[Apply & restart]** ボタンをクリックします。

---

### 確認 (Ubuntu側での操作)

設定が完了したら、WSL2 (Ubuntu) のターミナルに戻り、もう一度バージョン確認コマンドを打ってみてください。

```bash
docker --version

```

これで `Docker version 24.x.x...` のような表示が出れば開通完了です！
無事にバージョンが表示されたら、先ほどの `docker compose up -d` に再挑戦してみてください。

---

## 👤 You

permission denied while trying to connect to the Docker daemon socket at unix:///var/run/docker.sock: Get "http://%2Fvar%2Frun%2Fdocker.sock/v1.24/containers/json?all=1&filters=%7B%22label%22%3A%7B%22com.docker.compose.config-hash%22%3Atrue%2C%22com.docker.compose.project%3Deroge-db%22%3Atrue%7D%7D": dial unix /var/run/docker.sock: connect: permission denied

## 🤖 Gemini

このエラーは、Linuxにおける**「権限（Permission）」の洗礼**です。
「お前（現在のユーザー）には、Dockerという強力なシステムを操作する権利がない」と怒られています。

これを解決するには、あなた自身を「Dockerを操作できる特権グループ」に追加する必要があります。
インフラエンジニアとしては、単に `sudo` をつけて無理やり通すのではなく、**「ユーザーを正しいグループに所属させる」** という正攻法で解決しましょう。

### 解決手順

Ubuntuのターミナルで、以下のコマンドを1行ずつ実行してください。

1. **ユーザーを docker グループに追加する**
```bash
sudo usermod -aG docker $USER

```


* `usermod`: ユーザー設定を変更するコマンド
* `-aG`: 追加 (Append) してグループ (Group) に入れる
* `docker`: 対象のグループ名
* `$USER`: あなたの現在のユーザー名（自動で入ります）


2. **【重要】グループの変更を反映させる**
グループ設定を変えても、ログインし直すまでは反映されません。以下のコマンドで、WSL上で「ログインし直し」のような処理を行います。
```bash
newgrp docker

```



### 再トライ

これで権限が付与されました。先ほどのコマンドを（`sudo` なしで）実行してみてください。

```bash
docker compose up -d

```

### インフラ豆知識：なぜこのエラーが出るのか？

* **Dockerの実体**: 実はバックグラウンドで常に動いている「デーモン（守護神）」という常駐プログラムです。
* **通信手段**: 私たちが `docker` コマンドを打つと、`/var/run/docker.sock` という「ソケット（通信の窓口）」を通じて、そのデーモンに命令を送ります。
* **セキュリティ**: この「窓口」は非常に強力（OSの中身を書き換えられるレベル）なので、デフォルトでは **root（管理者）** か **dockerグループのメンバー** しか触れないように鍵がかかっています。今回はその鍵を開ける合鍵を自分に渡した、という作業でした。

---

**無事に `docker compose up -d` が通り、`done` と表示されたら教えてください！**
次はJupyterからDBへの接続確認を行います。

---

## 👤 You

ubuntuのターミナルって具体的にどこで入力すればよいの？

## 🤖 Gemini

おっと、基本の「場所」の確認ですね！非常に重要です。
Windows 11 + WSL2 の環境では、**「Ubuntuの黒い画面」を開く方法は主に2つ**あります。どちらでもOKですが、使い分けると便利です。

おすすめ順に紹介します。

### 1. エディタ (Cursor / Antigravity) の中で開く【おすすめ！】

今コードを書くのに使っているエディタの中でターミナルを開くと、画面を行き来しなくて済むので一番楽です。

1. **Cursor** を開く。
2. 上部メニューの **[Terminal]** → **[New Terminal]** をクリック（またはショートカット `Ctrl` + `Shift` + `@` か `Ctrl + `` ）。
3. 画面下にパネルが出てきます。
* **重要**: 右下の小さな文字を見てください。「**wsl**」や「**bash**」や「**Ubuntu**」と書いてあれば正解です。
* もし「powershell」と書いてあったら、その横の「＋」の右にある「ｖ」ボタンを押して「Ubuntu (WSL)」を選んでください。



### 2. Windowsのスタートメニューから開く（基本）

Windowsには最初から入っている「ターミナル」アプリがあります。

1. Windowsキーを押す（スタートメニューを開く）。
2. 検索バーに「**Ubuntu**」と入力。
3. オレンジ色のアイコン（またはペンギンのアイコン）のアプリが出てくるので、それをクリック。
4. 黒い画面が開き、`ユーザー名@PC名:~$` という文字が表示されればOKです。

---

### 「ここがUbuntuだ」と見分けるポイント

入力しようとしている画面の、**行の先頭**を見てください。

* **〇 正解 (Ubuntu/WSL)**:
`username@MyPC:~/eroge-db$` のように `$` マークで終わっている。
→ ここなら `docker compose up -d` などのLinuxコマンドが通ります。
* **× 間違い (PowerShell)**:
`PS C:\Users\username... >` のように `>` マークで終わっている。
→ ここだと `docker` コマンドは見つからないと言われたりします。

---

**どちらかの画面で、先ほどの「権限を与えるコマンド（`sudo usermod ...`）」と「ログインし直すコマンド（`newgrp docker`）」を入力してみてください！**

---

## 👤 You

PS Microsoft.PowerShell.Core\FileSystem::\\wsl.localhost\Ubuntu\home\rich\eroge-db> sudo usermod -aG docker $USER  このコンピューターでは Sudo が無効になっています。有効にするには、 に移動しますDeveloper Settings page設定アプリの

## 🤖 Gemini

**ストップ！** そのままでは動きません。
原因は、**「今いる場所が Windows (PowerShell) だから」** です。

エラーメッセージにある「Developer Settings」云々は気にしないでください。これはWindowsが `sudo` というコマンドを理解できずに勘違いしているだけです。

### 状況の整理

あなたのプロンプト（入力欄の左側）を見てください：
`PS Microsoft.PowerShell.Core...`
と書いてありますね。この **`PS`** は **PowerShell (Windows)** の印です。
Windowsには `sudo` というコマンドがないので、怒られてしまいました。

### 解決手順：Linuxの世界へ「ダイブ」する

その画面（PowerShell）のままで、以下の魔法の言葉（コマンド）を打って Enter を押してください。

```powershell
wsl

```

すると、表示が以下のように変わるはずです。

* **Before**: `PS ... >`
* **After**: `rich@... $` (または緑色の文字など)

行の最後が `>` から **`$`** に変わりましたか？
**これが「Ubuntuの中に入った」合図です。**

---

### やり直し

`$` マークが出ている状態（Ubuntuの中）になったら、改めて先ほどのコマンドを順番に入力してください。

1. **権限の付与**
```bash
sudo usermod -aG docker $USER
# パスワードを聞かれたら、Ubuntuを入れた時に設定したパスワードを入力（文字は表示されませんが入力されています）

```


2. **グループの更新**
```bash
newgrp docker

```


3. **Docker起動（本題）**
```bash
docker compose up -d

```



これでエラーなく `Running` や `Started` と出れば成功です！

---

## 👤 You

DBサーバーが無事に立ち上がりました！  次は、Python (Jupyter) からこのDBに接続できるかテスト してみましょう。  DBが Up 状態で、postgres_data ディレクトリが生成されていることが確認できたら教えてください。  接続用のライブラリ (psycopg2) の導入に進みます。  ここまで完了しました

## 🤖 Gemini

おめでとうございます！これであなたのマシンの中に**「データセンター（DBサーバー）」が誕生**しました。インフラエンジニアへの大きな一歩です。

では、**「アプリケーション（Python）からインフラ（DB）へ橋をかける」** 作業を行いましょう。

---

### Step 1: 接続用ライブラリのインストール

PythonがPostgreSQLと会話するには「通訳（ドライバ）」が必要です。それが `psycopg2` です。
WSLのターミナル（`.venv` が有効な状態）で以下を実行してください。

```bash
# 必ず仮想環境(.venv)に入っていることを確認してから実行
pip install psycopg2-binary

```

> **インフラ豆知識**:
> 本番環境では `psycopg2` (ソースからビルドする版) を使うのが正統派ですが、開発環境ではビルド不要ですぐ動く `psycopg2-binary` を使うのが一般的です。今回は手軽な `binary` を採用します。

---

### Step 2: Jupyter Notebook で接続テスト

エディタ（Cursor等）で `db_test.ipynb` というファイルを新規作成し、以下のコードを書いて実行（▶ボタン）してください。

このコードは、`docker-compose.yml` で設定したユーザー名とパスワードを使ってDBにログインし、「PostgreSQLのバージョン」を聞き出すテストです。

```python
import psycopg2

# 1. 接続設定（docker-compose.ymlの内容と合わせる）
connection_config = {
    "user": "myuser",
    "password": "mypassword",
    "host": "localhost",  # Dockerがポート5432をWSL(localhost)に繋いでくれている
    "port": "5432",
    "database": "erogedb"
}

# 2. 接続を試みる
try:
    # コネクション（回線）を開く
    conn = psycopg2.connect(**connection_config)
    
    # カーソル（命令を出す窓口）を作成
    cur = conn.cursor()
    
    # SQL実行: バージョン情報をください
    cur.execute("SELECT version();")
    
    # 結果を受け取る
    db_version = cur.fetchone()
    
    print("✅ 接続成功！")
    print(f"DBバージョン: {db_version[0]}")
    
    # お片付け
    cur.close()
    conn.close()

except Exception as e:
    print("❌ 接続失敗...")
    print(e)

```

---

### Step 3: 結果の確認

実行結果に **「✅ 接続成功！」** と表示されれば、**PythonとDocker DBの連携完了**です。

もし `❌ 接続失敗...` と出た場合は、エラーメッセージ（英語）をコピーして教えてください。
（よくあるのは、パスワードのタイプミスや、Dockerがまだ起動しきっていないケースです）

成功したら、次はいよいよ**「VNDBから取ってきたデータを、このDBに保存する（INSERT）」**コードを書いていきます！

---

## 👤 You

---------------------------------------------------------------------------ModuleNotFoundError                       Traceback (most recent call last)Cell In[1], line 1----> 1 import psycopg2      3 # 1. 接続設定（docker-compose.ymlの内容と合わせる）      4 connection_config = {      5     "user": "myuser",      6     "password": "mypassword",   (...)      9     "database": "erogedb"     10 }ModuleNotFoundError: No module named 'psycopg2'

## 🤖 Gemini

このエラーは **「Jupyter Notebook が、さっきインストールした仮想環境 (.venv) を見ていない」** という、Python開発で**最もあるあるなトラブル**です。

ターミナルでは `.venv` に入れましたが、Jupyter側が「別のPython（例えばWindowsに入っているPythonや、UbuntuのシステムPython）」を使ってしまっている状態です。

以下の手順で、Jupyterに「こっちの箱(.venv)を使って！」と教えてあげましょう。

### 解決手順 (Cursor / VS Code の場合)

1. **カーネルの変更**
現在開いている `.ipynb` ファイルの**画面右上**を見てください。
「Python 3.x.x」のような文字が表示されていると思います。そこをクリックします。
2. **正しい環境を選ぶ**
メニューが出てくるので、以下のように進んでください。
* **[Select Another Kernel...]** (もしあれば)
* **[Python Environments]** を選択
* リストの中から、パスに **`eroge-db/.venv`** が含まれているもの（★推奨マークがついていることが多いです）を選んでください。


3. **確認**
右上の表示が `.venv (Python ...)` に変わったら、もう一度セルの再生ボタン（▶）を押してみてください。

---

### それでもダメな場合の「奥の手」

もしUI操作でうまくいかない場合、Jupyterの中で直接インストールする魔法のコマンド（マジックコマンド）があります。
以下のコードを新しいセルに書いて実行してください。

```python
# %pip を使うと、"今このノートブックを動かしているPython" にインストールされます
%pip install psycopg2-binary

```

これを実行して `Successfully installed...` と出れば、その後の `import psycopg2` は成功するはずです。

**接続成功したら教えてください！次の「データ保存」に進みます。**

---

## 👤 You

カーネルの選択肢に.venvが出てきません

## 🤖 Gemini

[Note: Could not copy model response. Please manually copy and paste this response from message 9.]

---

## 👤 You

The following environment is selected: \\wsl.localhost\Ubuntu\home\rich\eroge-db\.venv\Scripts\python.exe  これが左下にでくるのにカーネル選択時にはappdateは以下のPython3.10.6しか出てきません

## 🤖 Gemini

鋭い観察です！そのパス（`...Scripts\python.exe`）が表示されていることこそが、**トラブルの決定的な証拠**です。

結論から言うと、現在エディタ（Cursor）が**「Windowsモード」で動いてしまっています。**
そのため、WSL（Linux）の中にあるファイルを、無理やりWindowsの機能（ネットワーク共有）越しに触っている状態です。

これを**「WSLモード（Remote Development）」**に切り替える必要があります。

### 1. 決定的な証拠：「Scripts」と「bin」

インフラエンジニアとして、この違いを覚えておくと一生役立ちます。

* **Windows の Python**: 仮想環境の中に **`Scripts`** フォルダを作ります。
* **Linux (Ubuntu) の Python**: 仮想環境の中に **`bin`** フォルダを作ります。

あなたが以前ターミナルで作ったのはLinux用の `.venv` なので、本来は `bin` があるはずです。しかし、エディタが `Scripts`（Windows用）を探しているということは、エディタが「ここはWindowsだ」と勘違いしているのです。

---

### 2. 解決手順：WSLモードへの接続

Cursor（またはVS Code）を「WSLの中に住まわせる」手順を行います。

1. **コマンドパレットを開く**
* `Ctrl` + `Shift` + `P` を押します。


2. **WSL接続コマンドを入力**
* 入力欄に `WSL` と打ち込みます。
* **「WSL: Connect to WSL」**（または **「WSL: New Window」**）という項目が出てくるので、それをクリックします。


3. **新しいウィンドウが開く**
* 左下のステータスバー（青や緑の帯）を見てください。
* **「WSL: Ubuntu」** と表示されていれば大成功です！これが「正しいインフラ開発の状態」です。


4. **フォルダを開き直す**
* 左上のメニューから [File] -> [Open Folder...] を選びます。
* 今度はWindowsのパス（Cドライブ等）ではなく、Linuxのディレクトリ構造が表示されるはずです。
* `/home/あなたのユーザー名/eroge-db` を探して [OK] を押してください。



---

### 3. カーネルの再選択

これでエディタは完全にLinuxの世界に入りました。

1. もう一度 `.ipynb` ファイルを開きます。
2. 右上のカーネル選択をクリックします。
3. 今度こそ、**「Python 3.x.x (eroge-db)」** またはパスが `/home/username/eroge-db/.venv/bin/python` となっているものが表示されるはずです。

それを選んで、実行ボタンを押してみてください。どうでしょうか？

---

## 👤 You

Could not establish connection to WSL distro "docker-desktop"

## 🤖 Gemini

このエラーは、WSLのシステム自体が少し「夏バテ」して固まってしまっているか、エディタが接続先を間違えようとしているサインです。

インフラエンジニアらしく、**「プロセスの完全再起動」**で解決しましょう。PCの再起動は不要です。

### 解決手順

Windowsの「PowerShell」を開いて（管理者権限でなくてもOK）、以下の手順を行ってください。

#### 1. すべてのLinuxを強制停止する

動いているUbuntuやDockerの裏方などを、一度すべてシャットダウンします。

```powershell
wsl --shutdown

```

※何も表示されずにコマンドが終われば成功です。

#### 2. Ubuntuの状態を確認する

少し待ってから（数秒）、以下のコマンドで生きているディストリビューションを確認します。

```powershell
wsl -l -v

```

ここで、`Ubuntu` という名前があり、STATEが `Stopped` になっていることを確認してください。

#### 3. エディタ (Cursor) から再接続

ここが重要です。**「どのLinuxに繋ぐか」**を明確にします。

1. Cursorを開く。
2. `Ctrl` + `Shift` + `P` を押す。
3. `WSL: Connect to WSL using Distro...` （**Distro**を指定して接続）という項目を探して選択してください。
* ※単なる "Connect to WSL" だと、勝手に動かない `docker-desktop` の方へ繋ぎに行こうとしてエラーになることがあります。


4. 選択肢が出てくるので、**「Ubuntu」** を選んでください。

---

これで左下が **「WSL: Ubuntu」** になり、フォルダを開いたときにLinuxの中身が見えれば成功です！
再接続できたら、もう一度Jupyterのカーネル選択を試してみてください。

---

## 👤 You

❌ 接続失敗...  connection to server at "localhost" (127.0.0.1), port 5432 failed: Connection refused  	Is the server running on that host and accepting TCP/IP connections?

## 🤖 Gemini

**原因は、さきほどの `wsl --shutdown` でサーバー（Dockerコンテナ）も一緒に停止してしまったからです。**
データセンターの電源を一度落としたので、サーバーの電源も入れ直す必要があります。

インフラエンジニアの基本動作として、**「エラーが出たら、まずサーバーの状態 (`status`) を確認する」** 癖をつけましょう！

### 1. サーバーの生存確認と再起動

WSL (Ubuntu) のターミナルで、以下のコマンドを順番に実行してください。

1. **現状確認**
```bash
docker compose ps

```


おそらく、何も表示されないか、`Exited`（停止中）になっているはずです。
2. **再起動（電源ON）**
```bash
docker compose up -d

```


`Running 1/1` や `Started` と出ればOKです。
3. **もう一度確認**
```bash
docker compose ps

```


`STATUS` が `Up` になっていることを必ず目で見て確認してください。

---

### 2. Jupyter で再トライ

サーバーが `Up` になったら、Jupyter Notebook に戻って、先ほどの接続テストのセル（`import psycopg2` ...）をもう一度実行（▶）してください。

今度は **「✅ 接続成功！」** と出るはずです。
うまくいったら教えてください！すぐにデータをDBに流し込むコード作成に移ります。

---

