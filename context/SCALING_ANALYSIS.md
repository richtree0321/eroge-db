# VNDB 全データ保存・画像保存におけるスケーリング分析とコスト試算

ユーザーからの質問「全情報を DB に保存する際の問題点」および「画像の容量とコスト」についての分析結果です。

## 1. VNDB の全情報をデータベースに保存する場合の問題点

VNDB には約 50,000 件以上の Visual Novel（VN）に加え、キャラクター、スタッフ、リリース情報など膨大なデータがあります。これらを全てローカル DB（PostgreSQL）に取り込む場合の課題は以下の通りです。

### 🚧 A. データ構造の複雑化 (Schema Complexity)

- **現状**: `visual_novels` テーブル 1 つに `JSONB` でタグなどを詰め込んでいます。
- **全データの場合**:
  - 「ある声優が出演しているゲームを探したい」
  - 「2010 年以降に発売された、特定の原画家が関わったゲーム」
  - これらを高速に検索するには、`JSONB` では限界があります。正規化（`characters`, `staff`, `releases` などの別テーブル作成）が必要になり、JOIN（結合）処理が増え、クエリが複雑になります。

### 🚧 B. データ同期の困難さ (Data Synchronization)

- **更新検知**: 毎日数十〜数百のゲームが更新・追加されます。API ですべてを毎日チェックするのは効率が悪く、制限に引っかかります。
- **削除対応**: VNDB 側で削除されたデータや、統合されたタグの処理をどう反映するか。VNDB は公式の「データダンプ（毎日生成される圧縮ファイル）」を提供しているため、大規模運用なら API ではなくダンプ取り込みの方が現実的です。

### 🚧 C. 検索パフォーマンス (Search Performance)

- **テキスト検索**: 全ゲームの説明文（Description）やレビューから全文検索をする場合、PostgreSQL の標準機能だけでは重くなります。`Elasticsearch` などの専用検索エンジンの導入検討が必要になります。

---

## 2. 画像データの容量試算

VNDB のデータを元に、画像を自前サーバーに保存する場合の容量を概算します。

**前提条件:**

- 対象ゲーム数: **50,000 タイトル**（VNDB の主要な登録数）
- パッケージ画像（Cover）: 1 枚/タイトル
- スクリーンショット: 平均 5 枚/タイトルと仮定

| データ種類             | 1 枚あたりの平均サイズ | 計算式                        | 合計容量      |
| :--------------------- | :--------------------- | :---------------------------- | :------------ |
| **パッケージ画像**     | 300 KB (0.3 MB)        | 50,000 件 × 0.3 MB            | **15 GB**     |
| **スクリーンショット** | 400 KB (0.4 MB)        | 50,000 件 × 5 枚 × 0.4 MB     | **100 GB**    |
| **キャラクター画像**   | 200 KB (0.2 MB)        | 50,000 件 × 3 キャラ × 0.2 MB | **30 GB**     |
| **合計概算**           |                        |                               | **約 145 GB** |

安全率も考慮すると、**200GB 〜 250GB** 程度のディスク容量（オブジェクトストレージ）が必要になります。

---

## 3. インフラコスト予測 (VPS vs AWS)

「月間 10 万アクセス（PV）」程度のサイトを想定して比較します。
※画像は転送量（帯域）を大量に消費するため、ここがコストの分かれ目になります。

### A. VPS (Virtual Private Server) 利用の場合

**例: AWS Lightsail, DigitalOcean, Linode, Xserver VPS など**
VPS は「転送量が含まれている」のが最大の特徴です。コストパフォーマンスが良いです。

- **プラン例**:
  - メモリ 4GB / SSD 80GB (月額 2,000 円〜3,000 円程度)
  - しかし、容量 250GB を確保するには上位プランか、追加ストレージが必要です。
- **オブジェクトストレージ追加**:
  - DigitalOcean Spaces / Linode Object Storage: 250GB で 月額 $5 (約 750 円)
- **合計コスト**:
  - サーバー代: 3,000 円
  - ストレージ代: 750 円
  - **計: 月額 3,750 円 程度**
  - **メリット**: 転送量が数 TB まで無料なので、画像がたくさん表示されても追加料金が発生しにくい。

### B. AWS (EC2 + S3 + CloudFront) 利用の場合

**プロフェッショナルな構成**ですが、従量課金には注意が必要です。

- **S3 (ストレージ)**:
  - 250GB 保存: 約 $6.00 /月
- **EC2 (サーバー)**:
  - t3.medium (そこそこの性能): 約 $30.00 /月
- **CloudFront (画像配信・転送量)**: **【重要】**
  - 画像だらけのサイトはここが跳ね上がります。
  - 1 ページ 2MB、月 10 万 PV = 200GB 転送
  - 転送量コスト: 200GB × $0.09 = **$18.00 /月**
- **合計コスト**:
  - $6 + $30 + $18 = **$54 (約 8,000 円) /月**
  - **リスク**: バズってアクセスが 10 倍になると、転送量コストも 10 倍（180 ドル）になります。

## 結論と推奨

1.  **DB 保存の全量化について**:

    - いきなり全量は大変です。「人気トップ 10,000 件」などに絞るか、まずは必要な項目（タイトル、ID、画像 URL）だけを全件保存し、詳細はアクセスされた時に API で取る「オンデマンド取得」も賢い戦略です。

2.  **画像保存について**:

    - **推奨は VPS + S3 互換オブジェクトストレージ** です。
    - AWS Lightsail には「Lightsail 一般用 (OS のみ)」以外に「Lightsail Object Storage」や「CDN」の固定料金プランもあります。これらを組み合わせるのが、個人開発では最も "お財布に優しい" 構成です。

3.  **最初のアクション**:
    - まずは現在の「画像直リンク（VNDB のサーバーを参照）」のまま開発を進め、アクセス数が増えてきたり、VNDB からブロックされそうになった段階で自社サーバーへの保存を切り替えるのが、スタートアップ的な「YAGNI（必要になるまでやらない）」の精神で良いと思います。
